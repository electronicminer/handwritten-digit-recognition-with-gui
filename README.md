# handwritten-digit-recognition-with-gui
Handwritten Digit Recognition | Python + Tkinter + PyTorch | MNIST CNN Model​

# python手写数字识别系统课程设计


## 1. 需求分析

本系统设计的目标是实现一个实用且交互友好的手写数字识别工具。需求分析细化如下：

* **单张数字识别**：
  用户能够上传或绘制单个数字图像，系统需高效准确识别数字类别，适应不同书写风格。

* **多数字图像处理**：
  现实场景中，图像往往包含多个数字，系统需要实现自动检测、分割各个数字区域，并按书写顺序批量预测，保证识别的完整性与准确性。

* **图形用户界面交互**：
  设计直观的GUI，允许用户通过鼠标在画布自由书写，系统实时识别，提高用户体验。支持图片导入功能方便多样化操作。

* **实时自动识别**：
  画布绘制完成后，系统自动将图像送入预处理和模型识别模块，无需额外点击，提升交互智能化。

* **模型训练与评估支持**：
  支持模型的训练和测试模块，能够监控训练过程，输出模型性能指标，如准确率和混淆矩阵，便于调优。

* **可扩展的摄像头实时识别**：
  预留摄像头实时输入接口，未来可扩展为动态数字识别。

需求分析兼顾功能实用性与用户体验。


## 2. 总体框架设计

系统整体结构如图所示：

```
+-------------------+
|     用户界面      |  ← 用户输入（画板绘制/图片导入）
+-------------------+
           ↓
+---------------------------+
|      图像预处理模块       |  ← 灰度转换、对比度增强、二值化、裁剪、居中缩放
+---------------------------+
           ↓
+-------------------+
|    数字切割模块    |  ← 多数字图像分割，轮廓检测提取数字区域
+-------------------+
           ↓
+-------------------+
|    CNN识别模型    |  ← 基于PyTorch实现的卷积神经网络模型预测数字类别
+-------------------+
           ↓
+-------------------+
|    结果展示模块    |  ← 识别结果反馈给用户界面显示
+-------------------+

```

## 3. 功能详细设计

### 3.1 图像预处理(mnist_style_preprocess)
灰度转换：将输入彩色图像转换为单通道灰度图。

对比度增强：采用 PIL.ImageEnhance.Contrast 提高数字笔迹的清晰度，默认增强系数为 2.0。

二值化处理：通过设定阈值将图像转为黑白，去除背景噪声，突出数字形状。

裁剪数字区域：自动识别数字所在的最小矩形区域，裁剪后缩放到 20x20。

数字居中：将缩放后的数字粘贴到 28x28 黑底图像中心，使其符合 MNIST 数据格式标准。

### 3.2 数字切割(detect_digits_line)

识别含多个数字的图像时，使用 OpenCV 进行如下处理：

* 图像灰度转换与二值化处理；
* 使用 `cv2.findContours` 查找外轮廓；
* 过滤小区域，避免噪声干扰。
* 使用 `cv2.boundingRect` 获取最小外接矩形；
* 按照 x 坐标对所有矩形排序，从而获取数字的正确排列顺序；
* 对每个区域分别进行预处理后送入模型预测。

### 3.3 CNN模型

CNN 模型结构如下：

```
输入：1×28×28 灰度图
 ↓ Conv2d(1, 32, 3) + ReLU + MaxPool
 ↓ Conv2d(32, 64, 3) + ReLU + MaxPool
 ↓ Flatten → Linear(3136, 128) → Dropout(0.5) → ReLU
 ↓ Linear(128, 10) → 输出 10 类别概率
```
网络结构：

* **两层卷积层（Conv2d）**:分别使用 32 和 64 个 3x3 卷积核，提取图像中的边缘、轮廓等局部特征，前两层分别提取低级和高级特征，后接 ReLU 和最大池化。
  
* **激活函数（ReLU）**：引入非线性因素，提高模型表达能力；

* **池化层（MaxPooling）**：下采样特征图，减少计算量并增强模型对位移和噪声的鲁棒性；

* **两层全连接层**:第一层 128 个神经元带 Dropout，第二层输出10类数字概率。整合局部特征，实现全局分类判断。

* **Dropout 层**：在训练过程中随机屏蔽部分神经元，有效防止过拟合；

* **输出层**：最终输出 10 类概率分布，对应数字 0~9。
训练参数：

* **优化器**：Adam，学习率 0.05。

* **损失函数**：交叉熵(CrossEntropyLoss)。

模型使用 ReLU 激活函数和 Dropout 正则化以防止过拟合。

性能：最终模型在 MNIST 测试集上准确率达到 98.86%。



### 3.4 模型训练

训练使用 `train.py` 脚本实现，关键设计如下：

* 使用 MNIST 数据集进行训练与测试；
* 将图像转换为单通道灰度图；
* 将图像尺寸缩放到 28x28 像素。保持输入大小一致；
* 将图像从 PIL 或 numpy 格式转换为 PyTorch 的张量（tensor）；
* 对图像像素做标准化；
 ```python
transform = transforms.Compose([
    transforms.Grayscale(),
    transforms.Resize((28, 28)),
    transforms.ToTensor(),
    transforms.RandomRotation(degrees=10),
    transforms.Normalize((0.1307,), (0.3081,))
])
```
* 使用 `Adam` 优化器，初始学习率为 0.05；
* 每轮训练后在测试集上评估模型性能，保存最佳模型；
* 使用 `CrossEntropyLoss` 作为损失函数；

最终模型测试准确率可达 98.86%。训练期间提供模型训练日志与准确率输出。

### 3.5 混淆矩阵分析

训练完成后，对模型在测试集上的表现进行混淆矩阵评估。
使用 seaborn 进行可视化分析，如图所示：
![image](https://github.com/user-attachments/assets/223d3549-d757-4f82-b99c-3e64cd225734)



该图展示模型对各数字分类的准确性，有助于定位混淆易发区域。

### 3.6 图形用户界面（GUI）与交互功能

GUI 是本项目的重要组成部分，采用 Tkinter 构建，具有以下特点：

* **画板功能**：用户可在画布上手写数字，松开鼠标后系统自动识别内容。
* **图片导入识别**：支持从本地导入图片进行识别，自动缩放并在画布中显示；
* **自动切割与识别**：对于含多个数字的图片或画板书写，调用 `detect_digits_line` 自动进行区域分割与批量识别；
* **现代化界面设计**：按钮样式、颜色配置统一美观，增强用户体验；
* **预测结果展示**：预测结果实时更新在界面下方。

系统在用户完成书写后会自动将画布内容保存为临时图像，并调用识别模块输出预测结果。
![image](https://github.com/user-attachments/assets/0bfa490b-5f5b-483f-b0b3-a096d5e5db12)
![image](https://github.com/user-attachments/assets/7cd9b985-8058-404b-ae9c-c0a22976172d)

## 4. 测试验证

通过以下方式进行了测试：

* **单张图像测试**：对手写数字样本进行多次预测，结果与真实标签高度一致。

* **多数字切割测试**：对多数字图片成功提取各数字，识别顺序正确，精度良好。

* **模型性能**：在MNIST官方测试集准确率98.86%，误识率低。

* **稳定性测试**：GUI操作流畅，预处理和识别速度满足实时需求。

* **扩展测试（摄像头识别）**：尽管受环境影响大，但基本实现了实时识别功能。(函数位于digit_recognition.py 中的capture_and_recognize)

## 5. 总结

本项目实现了一个完整的手写数字识别系统，涵盖了图像预处理、数字切割、CNN模型训练与推理、图形界面交互等模块。通过对比度增强和数字居中预处理，大幅提升了模型的识别准确率和鲁棒性。在开发过程中，针对原始图像中非标准数字风格导致识别准确率低的问题，特别引入了图像增强、中心对齐等预处理方法，使模型更好地适应真实场景。图形界面设计增强了用户体验，使非专业用户也能快速上手。自动识别机制提升了交互智能性，适合教学演示、系统集成等场景。系统在MNIST数据集上表现优秀，具有较好的实用性和扩展潜力。


